Домашнее задание 8

Дисциплина: Программирование на Python
Тема: Взаимодействие в WWW: взаимодействие с сервисами
Выполнил: Макаров Кирилл

⸻

Этап 1
	•	Установил и ознакомился со Scapy
	•	Запустил тестовый скрипт преподавателя для ознакомления

⸻

Этап 2

С помощью Scapy был перехвачен сетевой трафик при взаимодействии с сайтом Google Gruyere. Анализ показал наличие TCP-сессий на порту 443 (HTTPS), включая пакеты с флагами ACK, PSH, FIN и RST. Были идентифицированы IP-адреса серверов Google и сторонних сервисов.

Поскольку трафик зашифрован протоколом TLS, содержимое HTTP-запросов и ответов недоступно для анализа без MITM-дешифрования.

Результат:
2.png

⸻

Этап 3

Рекон-анализ сайта Google Gruyere

Анализ страницы New Snippet

В разделе New Snippet обнаружена форма пользовательского ввода, поддерживающая HTML-разметку. Поскольку введённый пользователем контент отображается на странице, данная форма является потенциальной точкой внедрения XSS-уязвимостей.

Эксплуатация уязвимости:

"<script>alert('XSS')</script>"

Результат:
Скрин newsnippet.png

⸻

Анализ страницы Upload

В разделе Upload обнаружена форма загрузки файлов. Поскольку загруженные файлы могут сохраняться на сервере и отображаться пользователю, данный функционал является потенциальной точкой внедрения XSS-уязвимостей через вредоносные HTML/JavaScript файлы или через имя файла.

Эксплуатация уязвимости:
	•	Создаём файл с расширением .html и содержимым:

<script>alert('XSS via Upload')</script>


	•	Загружаем данный файл на сайт на странице Upload
	•	Переходим по указанной ссылке

Результат:
Скрин alert.png

⸻

Анализ страницы Profile

В разделе Profile обнаружена форма редактирования профиля, содержащая несколько полей пользовательского ввода:
	•	User name
	•	Homepage
	•	Icon
	•	Private Snippet

Поскольку введённые данные сохраняются и отображаются на странице, данные поля являются потенциальными точками внедрения XSS-уязвимостей.

Эксплуатация уязвимости:

В поле Private Snippet вставляем:

<img src=x onerror="alert('XSS Private Snippet')">

и нажимаем Update.

Результат:
profile.png

Вывод
В ходе тестирования XSS-уязвимостей было обнаружено, что поля User name и Homepage имеют частичную фильтрацию пользовательского ввода, что предотвращает выполнение JavaScript-кода.

Однако поле Private Snippet не имеет достаточной фильтрации, что позволило выполнить stored XSS-атаку с использованием payload:

<img src=x onerror="alert('XSS')">


⸻

Этап 4
	•	Создаём локальную XSS-форму xss_test.html
	•	Запускаем HTTP-сервер:

python3 -m http.server 8080


	•	Создаём Scapy-сниффер sniff_stage4.py
	•	Для генерации трафика открываем:

http://127.0.0.1:8080/xss_test.html

и вставляем:

<img src=x onerror="alert('XSS')">



Результат:
	•	result.png
	•	result2.png

⸻

Вывод

В ходе эксперимента с использованием Scapy был перехвачен HTTP POST-запрос, содержащий XSS-payload. В теле запроса присутствовал параметр snippet с внедрённым JavaScript-кодом, что подтверждает передачу вредоносного скрипта по сети в открытом виде.

В ответ на запрос сервер вернул сообщение:

HTTP/1.0 501 Unsupported method ('POST')

что указывает на отсутствие поддержки метода POST. Однако сам факт обработки и ответа сервера подтверждает успешную передачу запроса.

Во время XSS-атаки в сетевом трафике произошли следующие изменения:
	•	До атаки: наблюдались только HTTP GET-запросы для загрузки веб-страницы
	•	Во время атаки: появился HTTP POST-запрос с пользовательскими данными и XSS-payload
	•	После атаки: сервер отправил HTTP-ответ с кодом состояния 501

Таким образом, XSS-атака привела к появлению POST-запросов с вредоносным содержимым в трафике, что подтверждает возможность перехвата и анализа таких атак при использовании незащищённого HTTP-соединения.

⸻

Этап 5

В ходе работы были обнаружены уязвимости, связанные с XSS-атаками, обработкой пользовательского ввода и передачей данных по сети. Для их устранения рекомендуется внедрить следующие меры защиты.
	1.	Строгая фильтрация и экранирование пользовательского ввода
Все данные, вводимые пользователем (формы New Snippet, Profile, Upload и другие), должны проходить серверную валидацию и HTML-экранирование.
	2.	Использование Content Security Policy (CSP)
CSP ограничивает выполнение встроенных скриптов и загрузку ресурсов только из доверенных источников.
	3.	Ограничение функционала загрузки файлов
	•	Проверка MIME-типа и расширения
	•	Запрет загрузки HTML и JavaScript файлов
	•	Хранение файлов вне web-директории
	4.	Использование HTTPS
Шифрование соединения предотвращает перехват и анализ HTTP-запросов и ответов, включая XSS-payload и cookies.
	5.	Использование безопасных cookie
Рекомендуемые атрибуты: HttpOnly, Secure, SameSite.
	6.	Серверная проверка входных данных
	•	Ограничение длины параметров
	•	Использование библиотек для безопасной обработки HTML
	•	Регулярный аудит безопасности

Реализация данных мер значительно снизит риск эксплуатации XSS-уязвимостей и повысит общий уровень безопасности веб-приложения.
